* A RECEIVE.PRG ROUTINE 

* 
* 
* TRAN.FXP 
* -------- 
*
SELECT 1
USE SHARED Tran ALIAS TRAN
SELECT 2
USE SHARED LdgrCod ALIAS LDGRCOD
SELECT 3
USE SHARED ITran ALIAS ITRAN
SELECT 4
USE SHARED DType ALIAS DTYPE
DEFINE WINDOW TRAN FROM INT((SROWS()-25)/1), INT((SCOLS()-80)/1) TO INT((SROWS()-25)/1)+24, INT((SCOLS()-80)/1)+79 NOFLOAT NOCLOSE SHADOW TITLE ' DAILY TRANSACTION ' NOMINIMIZE PANEL COLOR SCHEME 1
ACTIVATE WINDOW SAME TRAN
MDATE = CTOD('  /  /    ')
MC1 = 0
MC2 = 0
MC3 = 0
MDISC = SPACE(30)
MAMOUNT = 0
MDOC_NO = SPACE(6)
MDOC_TYPE = 0
MCR_DR = SPACE(1)
MLDGR_BAL = 0
MSTATUS = SPACE(2)
MLINE = 3
MANS = SPACE(1)
DO WHILE .T.
   DO DSPHEDPRO
   @ MLINE, 2 GET MDATE PICTURE ('99/99/9999')
   READ
   IF READKEY()=12 .OR. READKEY()=268
      CLOSE DATABASES
      RELEASE WINDOW TRAN
      RETURN
      EXIT
   ENDIF
   @ 22, 1 CLEAR TO 22, 78
   @ 22, 22 SAY 'Press F1 to see Document Type Code List' COLOR GR+/N 
   ON KEY LABEL F1 DO ShwDtyPro In Proc1
   @ MLINE, 13 GET MDOC_TYPE PICTURE '9'
   READ
   IF READKEY()=12 .OR. READKEY()=268
      LOOP
   ENDIF
   SELECT DTYPE
   SET ORDER TO Doc_Type
   SEEK MDOC_TYPE
   IF  .NOT. FOUND()
      WAIT WINDOW 'Data Type Not Exist'
      MDOC_TYPE = 0
      LOOP
   ENDIF
   @ MLINE, 15 GET MDOC_NO PICTURE '@!' VALID MDOC_NO<>SPACE(6) ERROR 'Document Number Can Not Be Blank'
   READ
   IF READKEY()=12 .OR. READKEY()=268
      LOOP
   ENDIF
   SELECT TRAN
   SET ORDER TO Type_No
   SEEK STR(MDOC_TYPE,1)+MDOC_NO
   IF FOUND()
      WAIT WINDOW 'Document Number Already Exist'
      MDOC_TYPE = 0
      MDOC_NO = SPACE(6)
      LOOP
   ENDIF
   DO WHILE .T.
      SELECT LDGRCOD
      SET ORDER TO Title
      @ 22, 1 CLEAR TO 22, 62
      @ 22, 27 SAY 'Press F1 to see Party Code List' COLOR GR+/N 
      ON KEY LABEL F1 DO ShwLdgPro In Proc1
      @ MLINE, 22 SAY '  -  -   '
      @ MLINE, 22 GET MC1 PICTURE '@2K 99' VALID MC1<>0 ERROR 'Ledger Head Code Can Not Be Blank - Press Esc To Exit'
      @ MLINE, 25 GET MC2 PICTURE '@2K 99' VALID MC2<>0 ERROR 'Ledger Head Code Can Not Be Blank - Press Esc To Exit'
      @ MLINE, 28 GET MC3 PICTURE '@3K 999' VALID MC3<>0 ERROR 'Ledger Head Code Can Not Be Blank - Press Esc To Exit'
      READ
      SET ORDER TO C123
      SEEK STR(MC1,2)+STR(MC2,2)+STR(MC3,3)
      IF  .NOT. FOUND()
         WAIT WINDOW 'Leadger Code Not Exist'
         MC1 = 0
         MC2 = 0
         MC3 = 0
         LOOP
      ELSE
         @ MLINE+1, 22 SAY TITLE
         EXIT
      ENDIF
   ENDDO
   IF READKEY()=12 .OR. READKEY()=268
      MDATE = CTOD('  /  /    ')
      MC1 = 0
      MC2 = 0
      MC3 = 0
      MDOC_NO = SPACE(6)
      MDOC_TYPE = 0
      LOOP
   ENDIF
   @ MLINE, 32 GET MDISC PICTURE '@!'
   @ MLINE, 63 GET MCR_DR PICTURE '@!' VALID MCR_DR='C' .OR. MCR_DR='D' ERROR 'C=Credit Or D=Debit'
   @ MLINE, 67 GET MAMOUNT PICTURE '99999999.99'
   READ
   MANS = 'N'
   @ MLINE, 0 GET MANS PICTURE '@!' VALID MANS='N' .OR. MANS='C' ERROR 'N=Next  C=Change'
   READ
   IF MANS='C'
      LOOP
   ELSE
      DO SAVDATPRO
      SELECT TRAN
      MC1 = 0
      MC2 = 0
      MC3 = 0
      MDISC = SPACE(30)
      MAMOUNT = 0
      MDOC_NO = SPACE(6)
      MDOC_TYPE = 0
      MCR_DR = SPACE(1)
      MLDGR_BAL = 0
      MSTATUS = SPACE(2)
      MANS = SPACE(1)
   ENDIF
   MLINE = MLINE+2
   IF MLINE>19
      @ 3, 0 CLEAR TO 21, 78
      MLINE = 3
   ENDIF
ENDDO

PROCEDURE DSPHEDPRO
@ 1, 2 SAY 'DATE'
@ 1, 14 SAY 'DOC #'
@ 1, 22 SAY 'PARTY CODE'
@ 1, 33 SAY 'DISCRIPTION'
@ 1, 61 SAY 'C/D'
@ 1, 66 SAY 'AMOUNT'

PROCEDURE SAVDATPRO
SELECT TRAN
APPEND BLANK
REPLACE DATE WITH MDATE
REPLACE C1 WITH MC1
REPLACE C2 WITH MC2
REPLACE C3 WITH MC3
REPLACE DOC_NO WITH MDOC_NO
REPLACE DOC_TYPE WITH MDOC_TYPE
REPLACE CR_DR WITH MCR_DR+'R'
REPLACE AMOUNT WITH MAMOUNT
REPLACE DISC WITH MDISC
FLUSH
SELECT LDGRCOD
IF STATUS='  '
   IF MCR_DR='D'
      MLDGR_BAL = MAMOUNT
      MSTATUS = 'DR'
   ELSE
      MLDGR_BAL = MAMOUNT
      MSTATUS = 'CR'
   ENDIF
ENDIF
IF STATUS='DR'
   IF MCR_DR='D'
      MLDGR_BAL = LDGR_BAL+MAMOUNT
      MSTATUS = 'DR'
   ELSE
      MLDGR_BAL = LDGR_BAL-MAMOUNT
      IF MLDGR_BAL>0
         MSTATUS = 'DR'
      ELSE
         MSTATUS = 'CR'
      ENDIF
   ENDIF
ENDIF
IF STATUS='CR'
   IF MCR_DR='C'
      MLDGR_BAL = LDGR_BAL+MAMOUNT
      MSTATUS = 'CR'
   ELSE
      MLDGR_BAL = LDGR_BAL-MAMOUNT
      IF MLDGR_BAL>0
         MSTATUS = 'CR'
      ELSE
         MSTATUS = 'DR'
      ENDIF
   ENDIF
ENDIF
REPLACE LDGR_BAL WITH ABS(MLDGR_BAL)
REPLACE STATUS WITH MSTATUS
FLUSH
